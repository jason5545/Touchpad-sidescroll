<Window x:Class="TouchpadAdvancedTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:local="clr-namespace:TouchpadAdvancedTool"
        xmlns:models="clr-namespace:TouchpadAdvancedTool.Models"
        mc:Ignorable="d"
        Title="Touchpad Advanced Tool"
        Height="700"
        Width="900"
        MinHeight="600"
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        ui:WindowHelper.UseModernWindowStyle="True"
        StateChanged="Window_StateChanged"
        Closing="Window_Closing">

    <Window.Resources>
        <!-- 值轉換器：bool 轉 Brush -->
        <local:BoolToBrushConverter x:Key="BoolToBrushConverter"
                                    TrueBrush="{StaticResource EnabledBrush}"
                                    FalseBrush="{StaticResource DisabledBrush}"/>

        <!-- 值轉換器：Enum 轉 Bool -->
        <local:EnumToBoolConverter x:Key="EnumToBoolConverter"/>

        <!-- 值轉換器：Enum 值列表 -->
        <local:EnumValuesConverter x:Key="EnumValuesConverter"/>

        <!-- 值轉換器：CornerAction 顯示文字 -->
        <local:CornerActionDisplayConverter x:Key="CornerActionDisplayConverter"/>

        <!-- ToggleSwitch 標題模板 -->
        <DataTemplate x:Key="ToggleSwitchHeaderTemplate">
            <TextBlock Text="{Binding}" FontSize="14" FontWeight="Normal"/>
        </DataTemplate>

        <!-- 系統匣 (NotifyIcon) -->
        <tb:TaskbarIcon x:Key="NotifyIcon"
                        x:Name="NotifyIcon"
                        IconSource="Resources/app.ico"
                        ToolTipText="Touchpad Advanced Tool"
                        TrayLeftMouseDown="NotifyIcon_TrayLeftMouseDown">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="開啟" Click="ShowWindow_Click" FontWeight="Bold"/>
                    <Separator/>
                    <MenuItem Header="啟用增強功能" IsCheckable="True"
                              IsChecked="{Binding Settings.IsEnabled, Mode=TwoWay}"/>
                    <Separator/>
                    <MenuItem Header="結束" Click="Exit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Window.Resources>

    <!-- 系統匣圖示 -->
    <Window.TaskbarItemInfo>
        <TaskbarItemInfo/>
    </Window.TaskbarItemInfo>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 標題列 -->
        <Border Grid.Row="0"
                Background="{DynamicResource SystemControlBackgroundAccentBrush}"
                Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Text="Touchpad Advanced Tool"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="White"/>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <Ellipse Style="{StaticResource StatusIndicatorStyle}"
                                 Fill="{Binding Settings.IsEnabled, Converter={StaticResource BoolToBrushConverter}}"/>
                        <TextBlock Text="{Binding StatusText}"
                                   FontSize="14"
                                   Foreground="White"
                                   Opacity="0.9"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="重置設定"
                            Command="{Binding ResetSettingsCommand}"
                            Margin="0,0,8,0"
                            Style="{StaticResource AccentButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 觸控板預覽區 -->
        <Border Grid.Row="1"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,1"
                Padding="20,16"
                Visibility="{Binding Settings.ShowTouchVisualization, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="觸控板即時預覽"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Margin="0,0,0,12"/>

                <!-- 觸控板視覺化畫布 -->
                <Border Background="#1A000000"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                        BorderThickness="2"
                        CornerRadius="12"
                        Height="200"
                        HorizontalAlignment="Center"
                        Width="400">
                    <Canvas x:Name="TouchpadCanvas"
                            ClipToBounds="True"
                            SizeChanged="TouchpadCanvas_SizeChanged">

                        <!-- 垂直捲動區高亮 -->
                        <Rectangle x:Name="ScrollZoneRect"
                                   Fill="#30FFFFFF"
                                   Stroke="#60FFFFFF"
                                   StrokeThickness="2"
                                   RadiusX="8"
                                   RadiusY="8"
                                   Opacity="0.6">
                            <Rectangle.Effect>
                                <BlurEffect Radius="2"/>
                            </Rectangle.Effect>
                        </Rectangle>

                        <!-- 水平捲動區高亮 -->
                        <Rectangle x:Name="HorizontalScrollZoneRect"
                                   Fill="#3000FFFF"
                                   Stroke="#6000FFFF"
                                   StrokeThickness="2"
                                   RadiusX="8"
                                   RadiusY="8"
                                   Opacity="0.6">
                            <Rectangle.Effect>
                                <BlurEffect Radius="2"/>
                            </Rectangle.Effect>
                        </Rectangle>

                        <!-- 觸控點指示器 -->
                        <Ellipse x:Name="TouchPoint"
                                 Width="40"
                                 Height="40"
                                 Fill="#DD4444"
                                 Stroke="#FF6666"
                                 StrokeThickness="3"
                                 Visibility="Collapsed"
                                 RenderTransformOrigin="0.5,0.5">
                            <Ellipse.RenderTransform>
                                <ScaleTransform x:Name="TouchPointScale" ScaleX="1" ScaleY="1"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#FF4444"
                                                BlurRadius="20"
                                                ShadowDepth="0"
                                                Opacity="0.8"/>
                            </Ellipse.Effect>
                        </Ellipse>

                        <!-- 觸控軌跡線 -->
                        <Polyline x:Name="TouchTrail"
                                  Stroke="#80FF4444"
                                  StrokeThickness="3"
                                  StrokeLineJoin="Round"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"
                                  Opacity="0.7"/>

                        <!-- 中央提示文字 -->
                        <TextBlock x:Name="HintText"
                                   Text="在觸控板上滑動以檢視即時預覽"
                                   FontSize="13"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Canvas.Left="200"
                                   Canvas.Top="90"
                                   RenderTransformOrigin="0.5,0.5">
                            <TextBlock.RenderTransform>
                                <TranslateTransform X="-100"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>
                    </Canvas>
                </Border>

                <!-- 狀態資訊 -->
                <Grid Margin="0,12,0,0" HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="觸控點: " FontSize="12" Opacity="0.7"/>
                        <TextBlock x:Name="TouchCountText" Text="0" FontSize="12" FontWeight="SemiBold"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <TextBlock Text="位置: " FontSize="12" Opacity="0.7"/>
                        <TextBlock x:Name="TouchPositionText" Text="—" FontSize="12" FontFamily="Consolas" FontWeight="SemiBold"/>
                    </StackPanel>

                    <StackPanel Grid.Column="4" Orientation="Horizontal">
                        <Ellipse Width="10" Height="10" VerticalAlignment="Center" Margin="0,0,6,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="#9E9E9E"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=TouchPoint, Path=Visibility}" Value="Visible">
                                            <Setter Property="Fill" Value="#4CAF50"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock x:Name="ScrollStateText" Text="待機中" FontSize="12" FontWeight="SemiBold"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>

        <!-- 主內容區 -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto"
                      Padding="20">
            <StackPanel MaxWidth="800">

                <!-- 主要開關 -->
                <Border Style="{StaticResource InfoCardStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="觸控板增強功能"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="White"/>
                            <TextBlock Text="在觸控板邊緣垂直滑動即可捲動頁面"
                                       FontSize="13"
                                       Foreground="White"
                                       Opacity="0.8"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <ui:ToggleSwitch Grid.Column="1"
                                        IsOn="{Binding Settings.IsEnabled, Mode=TwoWay}"
                                        OnContent="啟用"
                                        OffContent="停用"
                                        VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 觸控板資訊 -->
                <TextBlock Text="觸控板資訊" Style="{StaticResource SubheaderTextStyle}"/>
                <Border Style="{StaticResource SettingItemStyle}">
                    <TextBlock Text="{Binding TouchpadInfoText}"
                               TextWrapping="Wrap"
                               FontFamily="Consolas"
                               FontSize="12"/>
                </Border>

                <!-- 捲動區設定 -->
                <TextBlock Text="捲動區設定" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>

                <!-- 捲動區寬度 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="捲動區寬度"
                                   Style="{StaticResource SliderLabelStyle}"/>

                        <Grid Grid.Row="1" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.ScrollZoneWidth, Mode=TwoWay}"
                                    Minimum="5"
                                    Maximum="30"
                                    TickFrequency="1"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                                       Style="{StaticResource SliderValueStyle}"
                                       Margin="12,0,0,0">
                                <Run Text="{Binding Settings.ScrollZoneWidth, StringFormat='{}{0:F0}'}"/>
                                <Run Text="%"/>
                            </TextBlock>
                        </Grid>

                        <TextBlock Grid.Row="2"
                                   Text="觸控板邊緣用於捲動的區域寬度"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </Grid>
                </Border>

                <!-- 捲動行為 -->
                <TextBlock Text="捲動行為" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>

                <!-- 捲動速度 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="捲動速度"
                                   Style="{StaticResource SliderLabelStyle}"/>

                        <Grid Grid.Row="1" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.ScrollSpeed, Mode=TwoWay}"
                                    Minimum="0.5"
                                    Maximum="5.0"
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                                       Text="{Binding Settings.ScrollSpeed, StringFormat='{}{0:F1}x'}"
                                       Style="{StaticResource SliderValueStyle}"
                                       Margin="12,0,0,0"/>
                        </Grid>

                        <TextBlock Grid.Row="2"
                                   Text="調整捲動的速度倍率"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </Grid>
                </Border>

                <!-- 捲動靈敏度 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="捲動靈敏度"
                                   Style="{StaticResource SliderLabelStyle}"/>

                        <Grid Grid.Row="1" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.ScrollSensitivity, Mode=TwoWay}"
                                    Minimum="0.1"
                                    Maximum="5.0"
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                                       Text="{Binding Settings.ScrollSensitivity, StringFormat='{}{0:F1}x'}"
                                       Style="{StaticResource SliderValueStyle}"
                                       Margin="12,0,0,0"/>
                        </Grid>

                        <TextBlock Grid.Row="2"
                                   Text="調整觸發捲動所需的移動距離"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </Grid>
                </Border>

                <!-- 反轉捲動方向 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <ui:ToggleSwitch IsOn="{Binding Settings.InvertScrollDirection, Mode=TwoWay}"
                                    OnContent="已反轉"
                                    OffContent="正常"
                                    Header="反轉捲動方向"
                                    HeaderTemplate="{StaticResource ToggleSwitchHeaderTemplate}"/>
                </Border>

                <!-- 水平捲動區設定 -->
                <TextBlock Text="水平捲動區設定" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>

                <!-- 啟用水平捲動區 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="水平捲動區"
                                       FontSize="14"
                                       FontWeight="SemiBold"/>
                            <TextBlock Text="在觸控板頂部或底部水平滑動即可水平捲動"
                                       FontSize="12"
                                       Opacity="0.7"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <ui:ToggleSwitch Grid.Column="1"
                                        IsOn="{Binding Settings.EnableHorizontalScroll, Mode=TwoWay}"
                                        OnContent="啟用"
                                        OffContent="停用"
                                        VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 水平捲動區高度 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.EnableHorizontalScroll, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="水平捲動區高度"
                                   Style="{StaticResource SliderLabelStyle}"/>

                        <Grid Grid.Row="1" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.HorizontalScrollZoneHeight, Mode=TwoWay}"
                                    Minimum="5"
                                    Maximum="30"
                                    TickFrequency="1"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                                       Style="{StaticResource SliderValueStyle}"
                                       Margin="12,0,0,0">
                                <Run Text="{Binding Settings.HorizontalScrollZoneHeight, StringFormat='{}{0:F0}'}"/>
                                <Run Text="%"/>
                            </TextBlock>
                        </Grid>

                        <TextBlock Grid.Row="2"
                                   Text="觸控板頂部或底部用於水平捲動的區域高度"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </Grid>
                </Border>

                <!-- 水平捲動區位置 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.EnableHorizontalScroll, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="水平捲動區位置"
                                   Style="{StaticResource SliderLabelStyle}"/>

                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Margin="0,8,0,0">
                            <RadioButton Content="頂部"
                                        IsChecked="{Binding Settings.HorizontalScrollZonePosition,
                                                    Converter={StaticResource EnumToBoolConverter},
                                                    ConverterParameter=Top}"
                                        Margin="0,0,16,0"/>
                            <RadioButton Content="底部"
                                        IsChecked="{Binding Settings.HorizontalScrollZonePosition,
                                                    Converter={StaticResource EnumToBoolConverter},
                                                    ConverterParameter=Bottom}"/>
                        </StackPanel>

                        <TextBlock Grid.Row="2"
                                   Text="選擇觸控板頂部或底部作為水平捲動區"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </Grid>
                </Border>

                <!-- 反轉水平捲動方向 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.EnableHorizontalScroll, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ui:ToggleSwitch IsOn="{Binding Settings.InvertHorizontalScroll, Mode=TwoWay}"
                                    OnContent="已反轉"
                                    OffContent="正常"
                                    Header="反轉水平捲動方向"
                                    HeaderTemplate="{StaticResource ToggleSwitchHeaderTemplate}"/>
                </Border>

                <!-- 角落觸擊設定 -->
                <TextBlock Text="角落觸擊設定" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>

                <!-- 啟用角落觸擊 -->
                <Border Style="{StaticResource SettingItemStyle}">
                    <ui:ToggleSwitch IsOn="{Binding Settings.EnableCornerTap, Mode=TwoWay}"
                                    OnContent="已啟用"
                                    OffContent="已停用"
                                    Header="啟用角落觸擊功能"
                                    HeaderTemplate="{StaticResource ToggleSwitchHeaderTemplate}"/>
                </Border>

                <!-- 角落觸擊參數 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.EnableCornerTap, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <!-- 角落區域大小 -->
                        <Grid Margin="0,0,0,16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Text="角落區域大小"
                                       Style="{StaticResource SliderLabelStyle}"/>

                            <Grid Grid.Row="1" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Slider Grid.Column="0"
                                        Value="{Binding Settings.CornerTapSize, Mode=TwoWay}"
                                        Minimum="5"
                                        Maximum="20"
                                        TickFrequency="1"
                                        IsSnapToTickEnabled="True"/>

                                <TextBlock Grid.Column="1"
                                           Text="{Binding Settings.CornerTapSize, StringFormat={}{0:F0}%}"
                                           Style="{StaticResource SliderValueStyle}"/>
                            </Grid>
                        </Grid>

                        <!-- 觸擊時長 -->
                        <Grid Margin="0,0,0,16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Text="最大觸擊時長"
                                       Style="{StaticResource SliderLabelStyle}"/>

                            <Grid Grid.Row="1" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Slider Grid.Column="0"
                                        Value="{Binding Settings.CornerTapMaxDuration, Mode=TwoWay}"
                                        Minimum="100"
                                        Maximum="1000"
                                        TickFrequency="50"
                                        IsSnapToTickEnabled="True"/>

                                <TextBlock Grid.Column="1"
                                           Text="{Binding Settings.CornerTapMaxDuration, StringFormat={}{0:F0}ms}"
                                           Style="{StaticResource SliderValueStyle}"/>
                            </Grid>
                        </Grid>

                        <!-- 移動閾值 -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Text="移動容許範圍"
                                       Style="{StaticResource SliderLabelStyle}"/>

                            <Grid Grid.Row="1" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Slider Grid.Column="0"
                                        Value="{Binding Settings.CornerTapMovementThreshold, Mode=TwoWay}"
                                        Minimum="1"
                                        Maximum="10"
                                        TickFrequency="0.5"
                                        IsSnapToTickEnabled="True"/>

                                <TextBlock Grid.Column="1"
                                           Text="{Binding Settings.CornerTapMovementThreshold, StringFormat={}{0:F1}%}"
                                           Style="{StaticResource SliderValueStyle}"/>
                            </Grid>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 角落動作設定 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.EnableCornerTap, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 左上角 -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,12">
                            <TextBlock Text="左上角" FontWeight="SemiBold" Margin="0,0,0,4"/>
                            <ComboBox SelectedItem="{Binding Settings.TopLeftAction, Mode=TwoWay}"
                                      ItemsSource="{Binding Source={x:Type models:CornerAction}, Converter={StaticResource EnumValuesConverter}}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource CornerActionDisplayConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <!-- 右上角 -->
                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,12">
                            <TextBlock Text="右上角" FontWeight="SemiBold" Margin="0,0,0,4"/>
                            <ComboBox SelectedItem="{Binding Settings.TopRightAction, Mode=TwoWay}"
                                      ItemsSource="{Binding Source={x:Type models:CornerAction}, Converter={StaticResource EnumValuesConverter}}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource CornerActionDisplayConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <!-- 左下角 -->
                        <StackPanel Grid.Row="1" Grid.Column="0">
                            <TextBlock Text="左下角" FontWeight="SemiBold" Margin="0,0,0,4"/>
                            <ComboBox SelectedItem="{Binding Settings.BottomLeftAction, Mode=TwoWay}"
                                      ItemsSource="{Binding Source={x:Type models:CornerAction}, Converter={StaticResource EnumValuesConverter}}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource CornerActionDisplayConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <!-- 右下角 -->
                        <StackPanel Grid.Row="1" Grid.Column="2">
                            <TextBlock Text="右下角" FontWeight="SemiBold" Margin="0,0,0,4"/>
                            <ComboBox SelectedItem="{Binding Settings.BottomRightAction, Mode=TwoWay}"
                                      ItemsSource="{Binding Source={x:Type models:CornerAction}, Converter={StaticResource EnumValuesConverter}}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource CornerActionDisplayConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 進階設定 -->
                <TextBlock Text="進階設定" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>

                <Border Style="{StaticResource SettingItemStyle}">
                    <StackPanel>
                        <CheckBox Content="顯示觸控板即時預覽"
                                  IsChecked="{Binding Settings.ShowTouchVisualization, Mode=TwoWay}"
                                  Margin="0,0,0,8"/>
                        <CheckBox Content="開機自動啟動"
                                  IsChecked="{Binding Settings.StartWithWindows, Mode=TwoWay}"
                                  Margin="0,0,0,8"/>
                        <CheckBox Content="最小化到系統匣"
                                  IsChecked="{Binding Settings.MinimizeToTray, Mode=TwoWay}"
                                  Margin="0,0,0,8"/>
                        <CheckBox Content="除錯模式（顯示觸控座標）"
                                  IsChecked="{Binding Settings.DebugMode, Mode=TwoWay}"/>
                    </StackPanel>
                </Border>

                <!-- 除錯資訊 -->
                <Border Style="{StaticResource SettingItemStyle}"
                        Visibility="{Binding Settings.DebugMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="除錯資訊"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding DebugInfoText}"
                                   FontFamily="Consolas"
                                   FontSize="11"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- 關於 -->
                <TextBlock Text="關於" Style="{StaticResource SubheaderTextStyle}" Margin="0,16,0,8"/>
                <Border Style="{StaticResource SettingItemStyle}">
                    <StackPanel>
                        <TextBlock Text="Touchpad Advanced Tool v1.0"
                                   FontWeight="SemiBold"/>
                        <TextBlock Text="使用 Precision Touchpad API 實作觸控板進階功能"
                                   Style="{StaticResource CaptionTextStyle}"
                                   Margin="0,4,0,8"/>
                        <TextBlock Style="{StaticResource CaptionTextStyle}">
                            <Run Text="使用 Claude Code 建立"/>
                            <Hyperlink NavigateUri="https://claude.com/claude-code" RequestNavigate="Hyperlink_RequestNavigate">
                                <Run Text="了解更多"/>
                            </Hyperlink>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- 底部間距 -->
                <Border Height="20"/>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
